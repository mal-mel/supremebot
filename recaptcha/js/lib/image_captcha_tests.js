function TestBase(tests){this.tests=tests}TestBase.prototype.run=function(params){var result={testResults:{},totalPoints:0,set:[]};var testResult;for(var i in this.tests){if((typeof params.level=="undefined"&&typeof this.tests[i].level=="undefined"||params.level===this.tests[i].level)&&typeof this.tests[i].method=="function"){if(typeof this.tests[i].preMethod=="function"){this.tests[i].preMethod.call(this,params)}testResult=this.tests[i].method.call(this,params);result.testResults[i]={testInfo:this.tests[i],result:testResult};if(typeof testResult!="undefined"){if(testResult.constructor===Array){result.set=result.set.concat(testResult)}else if(typeof testResult=="boolean"){result.totalPoints+=testResult?typeof this.tests[i].points!="undefined"?this.tests[i].points:1:0}else if(typeof testResult=="number"){result.totalPoints+=testResult}else if(typeof testResult=="string"&&!isNaN(testResult)){result.totalPoints*=testResult}}}}return result};TestBase.prototype.runOnImageElementSet=function(params){var result={runResults:[],set:[]};var runParams=params;var runResult;for(var i in params.imageElementSet){runParams.imageElement=params.imageElementSet[i];runResult=this.run(params);result.runResults[i]={imageElement:params.imageElementSet[i],result:runResult}}result.runResults.sort(function(a,b){if(a.result.totalPoints<b.result.totalPoints){return typeof params.sort=="undefined"||params.sort!="asc"?1:-1}else if(a.result.totalPoints>b.result.totalPoints){return typeof params.sort=="undefined"||params.sort!="asc"?-1:1}return 0});for(var i in result.runResults){if(typeof params.filter=="undefined"||params.filter(result.runResults[i].result)){result.set.push(result.runResults[i].imageElement)}}return result};function IncludeTests(tests){TestBase.apply(this,arguments);this.tests={searchInForm:{method:function(params){return $(params.inputElement).closest("form").find("img").toArray()}},searchEverywhere:{method:function(params){return $(params.document).find("img").toArray()},level:2}}}IncludeTests.prototype=Object.create(TestBase.prototype);IncludeTests.prototype.constructor=IncludeTests;function ExcludeTests(tests){TestBase.apply(this,arguments);this.tests=tests?tests:{suitableSizeByWebVisum:{method:function(params){var ImgConstr={widthMin:5,widthMax:800,heightMin:5,heightMax:600,minArea:17*17};return!(params.imageElement.width>=ImgConstr.widthMin&&params.imageElement.width<=ImgConstr.widthMax&&params.imageElement.height>=ImgConstr.heightMin&&params.imageElement.height<=ImgConstr.heightMax&&params.imageElement.width*params.imageElement.height>ImgConstr.minArea);return false}},isVisibleForUser:{method:function(params){return params.imageElement.offsetHeight==0||params.imageElement.offsetWidth==0}},rumolaImageChecks:{method:function(params){try{if(!params.imageElement.src)return true;if(params.imageElement.src.length<5)return true;if(params.imageElement.style.visibility=="hidden")return true;if(params.imageElement.style.display=="none")return true;if(params.imageElement.width<=5)return true;if(params.imageElement.width>=650)return true;if(params.imageElement.height<5)return true;if(params.imageElement.height>250)return true}catch(e){}return false}},maxDistance:{preMethod:function(params){if(typeof params.distances!="undefined"){return}var distances=[];for(var i in params.imageElementSet){distances[i]={element:params.imageElementSet[i],distance:getDistanceBetweenElements(params.inputElement,params.imageElementSet[i])}}params.distances=distances},method:function(params){for(var i in params.distances){if(params.distances[i].element==params.imageElement&&params.distances[i].distance>500){return true}}}}}}ExcludeTests.prototype=Object.create(TestBase.prototype);ExcludeTests.prototype.constructor=ExcludeTests;function PointsTests(tests){TestBase.apply(this,arguments);this.tests={rumolaImageSrcFilterTest:{method:function(params){var rules=["[ck]apt?cha","robot","random","rnd","code","kod","geraimag","verif"];var internalPoints=0;for(var i in rules){if(new RegExp(rules[i],"img").test(params.imageElement.src)){internalPoints+=1}}return internalPoints}},securimageImageSrcFilterTest:{method:function(params){return/securimage_show/i.test(params.imageElement.src)}},mailRuImageSrcFilterTest:{method:function(params){return/c\.mail\.ru/i.test(params.imageElement.src)}},webVisumPattern:{method:function(params){var imageElementAsString=getElementAsString(params.imageElement);var rules=[{pattern:"captcha",weight:1},{pattern:"captha",weight:1},{pattern:"captch",weight:1},{pattern:"/fp/sec/f/",weight:2},{pattern:"fastchange.cc/captha",weight:1},{pattern:"\\.((jpg)|(gif)|(png)|(jpeg))[ '\"]",weight:-1},{pattern:"\\?",weight:1},{pattern:"[a-f0-9]{32}",weight:1},{pattern:"[a-z0-9_\\-]{20}",weight:1},{pattern:"security",weight:1},{pattern:"code",weight:1},{pattern:"token",weight:1},{pattern:"\\.((php)|(cgi)|(asp)|(ashx)|(cfm)|(jsp)|(rb)|(pl)|(py)|(htm)|(html))",weight:1},{pattern:"(verify|verification)",weight:1},{pattern:"human",weight:1},{pattern:"robot",weight:1},{pattern:"turing",weight:1},{pattern:"kontrollbild",weight:1},{pattern:"validation",weight:1},{pattern:"formshield",weight:1},{pattern:"fetchregimage",weight:2},{pattern:"capture",weight:1},{pattern:'id="cimg"',weight:1},{pattern:"forgot_password:imgSecurity2",weight:2},{pattern:"LoadBotImage",weight:1},{pattern:"Captcha\\.jpg",weight:1},{pattern:"imgcode1",weight:1},{pattern:"imgSecurityCode",weight:1},{pattern:"counter.yadro.ru",weight:-1},{pattern:"genimage\\.php",weight:1}];var internalPoints=0;for(var i in rules){if(new RegExp(rules[i].pattern,"img").test(imageElementAsString)){internalPoints+=rules[i].weight}}return internalPoints}},distanceInPixelsBetweeenElements:{preMethod:function(params){if(typeof params.distances!="undefined"){return}var distances=[];for(var i in params.imageElementSet){distances[i]={element:params.imageElementSet[i],distance:getDistanceBetweenElements(params.inputElement,params.imageElementSet[i])}}distances.sort(function(a,b){if(a.distance<b.distance){return-1}else if(a.distance>b.distance){return 1}return 0});for(var i in distances){switch(i*1){case 0:distances[i].internalPoints="1.2";break;case 1:distances[i].internalPoints="1.1";break;case 2:distances[i].internalPoints="1.1";break;default:distances[i].internalPoints="1"}}params.distances=distances},method:function(params){for(var i in params.distances){if(params.distances[i].element==params.imageElement){return params.distances[i].internalPoints}}}},biggerAreaSize:{preMethod:function(params){if(typeof params.sizes!="undefined"){return}var sizes=[];for(var i in params.imageElementSet){sizes[i]={element:params.imageElementSet[i],size:params.imageElementSet[i].width*params.imageElementSet[i].height}}sizes.sort(function(a,b){if(a.size<b.size){return 1}else if(a.size>b.size){return-1}return 0});var maxSize=sizes[0].size;for(var i in sizes){if(sizes[i].size==maxSize){sizes[i].internalPoints="1.1"}else{sizes[i].internalPoints="1"}}params.sizes=sizes},method:function(params){for(var i in params.sizes){if(params.sizes[i].element==params.imageElement){return params.sizes[i].internalPoints}}}}}}PointsTests.prototype=Object.create(TestBase.prototype);PointsTests.prototype.constructor=PointsTests;